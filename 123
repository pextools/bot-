import asyncio
import time
from telethon import TelegramClient, events
from telethon.tl.types import UserStatusOnline, UserStatusOffline

# –ü–æ–ª—É—á–∞–µ–º —Ç—É—Ç: https://my.telegram.org/apps
api_id = 1234567  # –≤–≤–µ–¥–∏ —Å–≤–æ–π
api_hash = '—Ç–≤–æ–π_api_hash'  # –≤–≤–µ–¥–∏ —Å–≤–æ–π
phone = '+380675289791'  # —Ç–≤–æ–π –Ω–æ–º–µ—Ä

client = TelegramClient('session_name', api_id, api_hash)

# –ë–∞–∑–∞ –æ—Ç–≤–µ—Ç–æ–≤
responses = {
    '–ø—Ä–∏–≤–µ—Ç': ['–ü—Ä–∏–≤–µ—Ç!', '–ó–¥–∞—Ä–æ–≤–∞!', '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é!'],
    '–∫–∞–∫ –¥–µ–ª–∞': ['–ù–æ—Ä–º!', '–í—Å—ë –æ–∫', '–ë—ã–≤–∞–ª–æ –ª—É—á—à–µ)'],
    '–≥–¥–µ —Ç—ã': ['–ù–µ –æ–Ω–ª–∞–π–Ω, –æ—Ç–≤–µ—á—É –ø–æ–∑–∂–µ', '–°–∫–æ—Ä–æ –≤–µ—Ä–Ω—É—Å—å'],
    '–Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ': ['–ù–µ –º–æ–≥—É —Å–µ–π—á–∞—Å –æ—Ç–≤–µ—Ç–∏—Ç—å, –Ω–∞–ø–∏—à–∏ –ø–æ–∑–∂–µ'],
    '–ø–æ–∫–∞': ['–ë—ã–≤–∞–π!', '–£–¥–∞—á–∏!'],
    'default': ['–°–µ–π—á–∞—Å –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å, –Ω–æ —Å–∫–æ—Ä–æ —É–≤–∏–∂—É —Å–æ–æ–±—â–µ–Ω–∏–µ']
}

# –°–ø–∏—Å–æ–∫ ID, –∫–æ–º—É –æ—Ç–≤–µ—á–∞—Ç—å (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
ALLOWED_USERS = []  # –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –≤—Å–µ–º
# –∏–ª–∏ –¥–æ–±–∞–≤—å ID: [123456789, 987654321]

# –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞
def get_response(message):
    msg_lower = message.lower()
    for key in responses:
        if key != 'default' and key in msg_lower:
            return responses[key][0]  # –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
    return responses['default'][0]

@client.on(events.NewMessage(incoming=True))
async def handler(event):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ —á–∞—Ç/–∫–∞–Ω–∞–ª)
    if not event.is_private:
        return
    
    sender = await event.get_sender()
    
    # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    if ALLOWED_USERS and sender.id not in ALLOWED_USERS:
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–≤–æ–π —Å—Ç–∞—Ç—É—Å (–æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω)
    me = await client.get_me()
    my_status = await client.get_entity(me.id)
    
    # –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—ã –æ—Ñ–ª–∞–π–Ω (–∏–ª–∏ –≤—Å–µ–≥–¥–∞)
    auto_reply = True  # –º–µ–Ω—è–π –Ω–∞ False –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ñ–ª–∞–π–Ω–µ
    
    if auto_reply:
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º (—á—Ç–æ–±—ã –Ω–µ —Å—Ä–∞–∑—É)
        await asyncio.sleep(2)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
        response_text = get_response(event.message.message)
        await event.reply(f"ü§ñ –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç: {response_text}")
        
        # –õ–æ–≥–∏—Ä—É–µ–º
        print(f"[{time.ctime()}] –û—Ç–≤–µ—Ç–∏–ª {sender.first_name}: {event.message.message}")

async def main():
    await client.start(phone)
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –û—Ç–≤–µ—á–∞—é –≤ –õ–°...")
    await client.run_until_disconnected()

if __name__ == '__main__':
    client.loop.run_until_complete(main())
